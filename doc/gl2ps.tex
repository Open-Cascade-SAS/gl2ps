%
%  GL2PS, an OpenGL to PostScript Printing Library
%  Copyright (C) 1999-2002  Christophe Geuzaine 
%
%  $Id: gl2ps.tex,v 1.63 2003-01-22 02:33:55 geuzaine Exp $
% 
%  E-mail: geuz@geuz.org
%  URL: http://www.geuz.org/gl2ps/
% 
%  This library is free software; you can redistribute it and/or
%  modify it under the terms of the GNU Library General Public
%  License as published by the Free Software Foundation; either
%  version 2 of the License, or (at your option) any later version.
% 
%  This library is distributed in the hope that it will be useful,
%  but WITHOUT ANY WARRANTY; without even the implied warranty of
%  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
%  Library General Public License for more details.
% 
%  You should have received a copy of the GNU Library General Public
%  License along with this library; if not, write to the Free
%  Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
% 

\documentclass[10pt]{article}

\pagestyle{headings}
\setcounter{tocdepth}{2}
\sloppypar
\ifx\pdfoutput\undefined
  \usepackage{url}
\else
  \usepackage[colorlinks=true,urlcolor=blue]{hyperref}
  \pdfinfo{
    /Title (GL2PS: an OpenGL to PostScript printing library)
    /Author (Christophe Geuzaine)
    /Subject (Documentation)
    /Keywords (OpenGL, PostScript, Printing)
  } 
\fi
\newcommand\dd{\begingroup\Url}
\newcommand\email{\dd}

%%tth: \def\dd#1{\textmd{\texttt{#1}}}
%%tth: \def\url#1{\href{#1}{#1}}
%%tth: \def\email#1{\href{mailto:#1}{#1}}

\begin{document}

\title{GL2PS: an OpenGL to PostScript printing library}
\author{Christophe Geuzaine}
\date{Version 0.72, 21 January 2002}

\maketitle

%%tth: \section*{Download}
%%tth: The current distribution of GL2PS is available either as a
%%tth: \href{http://www.geuz.org/gl2ps/src/gl2ps-0.72.tar.gz}{tar.gz}
%%tth: or as a 
%%tth: \href{http://www.geuz.org/gl2ps/src/gl2ps-0.72.zip}{zip}
%%tth: archive. These archives contain both a
%%tth: \href{http://www.geuz.org/gl2ps/gl2ps.ps}{PostScript}
%%tth: and a
%%tth: \href{http://www.geuz.org/gl2ps/gl2ps.pdf}{PDF}
%%tth: version of the documentation. Older versions are still
%%tth: available \href{http://www.geuz.org/gl2ps/src/}{here}.

\tableofcontents

\section{Introduction}

GL2PS is a library for creating high quality vector output (primarily
PostScript) from any OpenGL application. The main difference between GL2PS
and other similar libraries (see section~\ref{sec:links}) is the use of
sorting algorithms capable of handling intersecting and stretched polygons,
as well as non manifold objects.

The library, written in C, is released under the GNU Library General Public
License (see \url{http://www.gnu.org/} for more details), and is available
at \url{http://www.geuz.org/gl2ps/}. Any corrections, questions or
suggestions should be e-mailed to \email{geuz@geuz.org}.

The interface consists of eight functions, all beginning with the prefix
\dd{gl2ps}. All the data structures and the symbolic constants peculiar to
GL2PS begin with \dd{GL2PS}.


\section{Usage}

\subsection{\texttt{gl2psBeginPage} and \texttt{gl2psEndPage}}

\subsubsection{Specification}

\begin{verbatim}
void gl2psBeginPage( const char *title, const char *producer,
                     GLint format, GLint sort, GLint options, 
                     GLint colormode, GLint colorsize, 
                     GL2PSrgba *colortable, GLint buffersize,
                     FILE *stream, const char *filename )
\end{verbatim}

\begin{verbatim}
void gl2psEndPage( void )
\end{verbatim}

\subsubsection{Description}

\dd{gl2psBeginPage} and \dd{gl2psEndPage} delimit the OpenGL commands that
will be caught in the feedback buffer and output to \dd{stream}. The
parameters given to \dd{gl2psBeginPage} determine the way primitives are
handled:

\begin{description}

\item[\dd{title}] Specifies the plot title. For PostScript output, this
string is placed in the \texttt{\%\%Title} field.

\item[\dd{producer}] Specifies the plot producer. For PostScript output,
this string is placed in the \texttt{\%\%For} field.

\item[\dd{format}] Specifies the output format, chosen among:

\begin{description}

\item[\dd{GL2PS_PS}] The output stream will be a PostScript file. 

\item[\dd{GL2PS_EPS}] The output stream will be an Encapsulated PostScript
file.

\item[\dd{GL2PS_TEX}] The output stream will be a \LaTeX\ file, containing
only the text strings of the plot (cf.\ section~\ref{sec:gl2psText}), as
well as an \verb+\includegraphics+ command permitting to include a graphic
file having the same basename as \dd{filename}.\footnote{The two steps to
generate a \LaTeX\ plot with GL2PS are thus:
\begin{enumerate}
\item generate the PostScript file (e.g.\ \dd{file.ps}) with no text
strings, using the \dd{GL2PS_PS} or \dd{GL2PS_EPS} format combined with the
\dd{GL2PS_NO_TEXT} option;
\item generate the \LaTeX\ file \dd{file.tex}, using the \dd{GL2PS_TEX}
format and specifying \dd{file.tex} as the \dd{filename} argument to
\dd{gl2psBeginPage}.
\end{enumerate}
You can of course combine the \LaTeX\ output with other graphic formats than
PostScript. For example, you may transform \dd{file.ps} into \dd{file.pdf}
and use pdf\LaTeX\ with the same \dd{file.tex} as for PostScript. You may
also use a bitmap image (e.g.\ Jpeg or png) and still combine it with
\dd{file.tex}.}

\end{description}

\item[\dd{sort}] Specifies the sorting algorithm, chosen among:

\begin{description}

\item[\dd{GL2PS_NO_SORT}] The primitives are not sorted, and are output in
\dd{stream} in the order they appear in the feedback buffer.

\item[\dd{GL2PS_SIMPLE_SORT}] The primitives are sorted according to their
barycenter. This can be sufficient for simple scenes.

\item[\dd{GL2PS_BSP_SORT}] The primitives are inserted in a BSP tree. The
tree is then traversed back to front in a painter-like algorithm. This
should be used for complex three-dimensional scenes, but keep in mind that
the BSP tree algorithm is quite memory hungry...

\end{description}

\item[\dd{options}] Sets global plot options, chosen among (multiple options
can be combined with the bitwise inclusive OR symbol \dd{|}):

\begin{description}

\item[\dd{GL2PS_NONE}] No option.

\item[\dd{GL2PS_DRAW_BACKGROUND}] The background frame is drawn.

\item[\dd{GL2PS_SIMPLE_LINE_OFFSET}] A small offset is added in the z-buffer
to all the lines in the plot. This is a simplified version of the
\dd{GL2PS_POLYGON_OFFSET_FILL} functionality
(cf. section~\ref{sec:gl2psEnable}), putting all the lines of the rendered
image slightly in front of their actual position. This thus performs a
simple anti-aliasing solution, e.g. for finite element like meshes.

\item[\dd{GL2PS_SILENT}] All the messages written by GL2PS on the error
stream are suppressed.

\item[\dd{GL2PS_BEST_ROOT}] The construction of the BSP tree is optimized by
choosing the root primitives leading to the minimum number of splits.

\item[\dd{GL2PS_NO_TEXT}] All the text strings are suppressed from
output. This is useful to produce the image part of a \LaTeX\ output.

\item[\dd{GL2PS_LANDSCAPE}] Landscape orientation instead of portrait.

\item[\dd{GL2PS_NO_PS3_SHADING}] No use is made of the \dd{shfill}
PostScript level 3 operator (which can lead to problems when converting
PostScript files to PDF files; see also section~\ref{sec:gl2psNumShadeColors}).

\item[\dd{GL2PS_OCCLUSION_CULL}] All the hidden polygons are removed from
the output, thus substantially reducing the size of the output file.

\end{description}

\item[\dd{colormode}] Specifies the color mode: \dd{GL_RGBA} or
\dd{GL_COLOR_INDEX}.

\item[\dd{colorsize}] Specifies the size of the colormap if \dd{colormode} is
\dd{GL_COLOR_INDEX}.

\item[\dd{colortable}] Contains the colormap if \dd{colormode} is
\dd{GL_COLOR_INDEX}. This colormap must contain \dd{colorsize} elements of type
\dd{GL2PSrgba}.

\item[\dd{buffersize}] Specifies the size of the feedback buffer.

\item[\dd{stream}] Specifies the stream to which data is printed.

\item[\dd{filename}] Specifies a name for the stream to which data is
printed.

\end{description}

\subsection{\texttt{gl2psText}}
\label{sec:gl2psText}

\subsubsection{Specification}

\begin{verbatim}
void gl2psText( const char *string, const char *fontname,
                GLint fontsize )
\end{verbatim}

\subsubsection{Description}

\dd{gl2psText} permits to include text in the PostScript or \LaTeX\ output
in a very simple way. The text is inserted at the current raster position
(set by one of the \dd{glRasterPos} OpenGL commands). Beware that text will
be sorted according to the position of the leftmost element of the string
only. The parameters are:

\begin{description}
\item[\dd{string}] Specifies the text string to print.

\item[\dd{fontname}] Specifies the name of a valid PostScript font (for
example \dd{"Times"} or \dd{"HelveticaBoldItalic"}). This parameter has no
influence for \LaTeX\ output.

\item[\dd{fontsize}] Specifies the size of the font. This parameter has no
influence for \LaTeX\ output.
\end{description}

\subsection{\texttt{gl2psEnable} and \texttt{gl2psDisable}}
\label{sec:gl2psEnable}

\subsubsection{Specification}

\begin{verbatim}
void gl2psEnable( GLint mode )
\end{verbatim}

\begin{verbatim}
void gl2psDisable( GLint mode )
\end{verbatim}

\subsubsection{Description}

\dd{gl2psEnable} and \dd{gl2psDisable} delimit OpenGL commands to which a local
\dd{mode} is applied. These modes are:

\begin{description}
\item[\dd{GL2PS_POLYGON_OFFSET_FILL}] Tries to emulate the
\dd{GL_POLYGON_OFFSET_FILL} functionality. The value of the offset is taken as
the current value of the corresponding OpenGL offset (set with
\dd{glPolygonOffset}). Not fully functional yet.

\item[\dd{GL2PS_POLYGON_BOUNDARY}] Not implemented yet.

\item[\dd{GL2PS_LINE_STIPPLE}] Tries to emulate the \dd{GL_LINE_STIPPLE}
functionality.
\end{description}

\subsection{\texttt{gl2psPointSize} and \texttt{gl2psLineWidth}}
\label{sec:gl2psPointSize}

\subsubsection{Specification}

\begin{verbatim}
void gl2psPointSize( GLfloat value )
\end{verbatim}

\begin{verbatim}
void gl2psLineWidth( GLfloat value )
\end{verbatim}

\subsubsection{Description}

\dd{gl2psPointSize} and \dd{gl2psLineSize} emulate the standard
\dd{glPointSize} and the \dd{glLineWidth} functions. They are necessary
since the point sizes and line widths are not saved in the OpenGL feedback
buffer.

\subsection{\texttt{gl2psNumShadeColors}}
\label{sec:gl2psNumShadeColors}

\subsubsection{Specification}

\begin{verbatim}
void gl2psNumShadeColors( GLint nr, GLint ng, GLint nb )
\end{verbatim}

\subsubsection{Description}

\dd{gl2psNumShadeColors} controls the number flat-shaded (sub-)triangles
used to approximate a smooth-shaded triangle when the \dd{shfill} operator
is not supported by the system, or when the \dd{GL2PS_NO_PS3_SHADING} option
is set. The arguments \dd{nr}, \dd{ng} and \dd{nb} specify the number of
values used for interpolating the full range of red, green and blue color
components; that is, a triangle is recursively subdivided until the color
difference between two of its vertices is smaller that $1/\mathtt{nr}$ for
the red component, $1/\mathtt{ng}$ for the green component and
$1/\mathtt{nb}$ for the blue component. The last call before
\dd{gl2psEndPage} is the one taken into account.

\section{Example}

Here is a typical calling sequence to produce BSP sorted PostScript output
in the file \dd{"MyFile"}, with all the lines slightly shifted front in the
z-buffer and all invisible primitives removed to reduce the size of the
output file. The \dd{draw()} function contains all the OpenGL commands.

\begin{verbatim}
FILE *fp = fopen("MyFile", "w");
int buffsize = 0, state = GL2PS_OVERFLOW;

while( state == GL2PS_OVERFLOW ){ 
  buffsize += 1024*1024;
  gl2psBeginPage ( "MyTitle", "MySoftware", 
                   GL2PS_EPS, GL2PS_BSP_SORT,
                   GL2PS_SIMPLE_LINE_OFFSET | GL2PS_SILENT |
                   GL2PS_OCCLUSION_CULL | GL2PS_BEST_ROOT,
                   GL_RGBA, 0, NULL, buffsize, fp, NULL );
  draw(); 
  state = gl2psEndPage();
}

fclose(fp);
\end{verbatim}

\noindent To output the text \dd{"MyText"} at the current raster position, the
\dd{draw()} function should contain something like:

\begin{verbatim}
gl2psText("MyText", "Courier", 12);
\end{verbatim}

If you plan to convert the PostScript file to a PDF file you may need to
disable the use of the Level 3 PostScript \dd{shfill} operator, i.e.\ add
\dd{GL2PS_NO_PS3_SHADING} to the list of options. Note that you can also
edit the output file a posteriori (just set \dd{/tryPS3shading} to
\dd{false} in the PostScript file header).

A complete example (\dd{gl2psTest.c}) is included in the distribution.

\section{Limitations}
\label{sec:limitations}

GL2PS works by capturing the contents of the OpenGL feedback
buffer\footnote{Check the documentation of \dd{glRenderMode(GL_FEEDBACK)} in
your favorite OpenGL reference. See also section~\ref{sec:links} for links
to other libraries using the same principle.}. As such, all the OpenGL
operations applied in the pipeline after the creation of the feedback buffer
will be ignored or have to be duplicated by GL2PS (e.g.\ font rendering,
polygon offset or line stippling: see sections~\ref{sec:gl2psText},
\ref{sec:gl2psEnable} and \ref{sec:gl2psPointSize}).

Other limitations include:
\begin{itemize}
\item 
Rendering large and/or complicated scenes is slow and/or can lead to large
output files. This is normal: vector-based images are not destined to
replace bitmaps. They just offer an alternative when high quality
(especially for 2D and small 3D plots) and ease of manipulation (how do you
change the scale, the labels or the colors in a bitmap picture long after
the picture was produced, and without altering its quality?) are important.
\item
Transparency is not supported yet. See the \dd{TODO} file for some
explanations why this may or may not be possible.
\item
GL2PS does not support textures, volumic rendering, fog effects, etc. One
could imagine producing mixed mode vector/bitmap output, but this has not
been implemented yet.
\end{itemize}

% Other implementation Notes:
%
% OpenGL feedback buffer
% describe Simple depth sort
%          3D BSP tree
%          2D BSP image tree for occlusion culling
% float vs. double
% polygon offsets
% PostScript shading

\section{Contributors}
\label{sec:contrib}

Michael Sweet (\email{mike@easysw.com}) for the original implementation of
the feedback buffer parser; Bruce Naylor (\email{naylor@comp-graphics.com})
for BSP tree and occlusion culling hints; Marc Um{\'e}
(\email{marc.ume@digitalgraphics.be}) for the original list code;
Jean-Fran\c{c}ois Remacle (\email{remacle@scorec.rpi.edu}) for plane
equation fixes; Bart Kaptein (\email{B.L.Kaptein@lumc.nl}) for memory leak
fixes; Quy Nguyen-Dai (\email{quy@vnilux.com}) for output file size
optimization; Sam Buss (\email{sbuss@ucsd.edu}) for the \dd{shfill}-based
smooth shaded triangle code; Shane Hill
(\email{Shane.Hill@dsto.defence.gov.au}) for the landscape option
implementation; Romain Boman (\email{r_boman@yahoo.fr}) for the Windows dll
generation; Rouben Rostamian (\email{rostamian@umbc.edu}) for various bug
fixes; Diego Santa Cruz (\email{Diego.SantaCruz@epfl.ch}) for the new
optimized shaded triangle code and the \dd{shfill} management; Shahzad
Muzaffar (\email{Shahzad.Muzaffar@cern.ch}) and Lassi Tuura
(\email{lassi.tuura@cern.ch}) for the new occlusion culling code and the
improvement of \dd{GL2PS_BEST_ROOT}.

\section{Links}
\label{sec:links}

Projects similar to \dd{GL2PS} include: Michael Sweet's GLP library
(\url{http://www.easysw.com/~mike/opengl/index.html}); Mark J. Kilgard's
rendereps (\url{http://www.opengl.org/developers/code/mjktips/Feedback.html}); the
GLpr library from CEI international (\url{http://www.ceintl.com/}; this
product does not seem to be available anymore).

Toby White (\email{tow@sdf.lonestar.org}) maintains a Python wrapper for
\dd{GL2PS}, available at
\url{http://www-theor.ch.cam.ac.uk/people/tow/software.html}.

\section{Versions}

\begin{description}
\item[0.1] (Feb 12, 2000) First distributed version.
\item[0.2] (Feb 20, 2000) Added \dd{GL2PS_POLYGON_BOUNDARY} and
\dd{GL2PS_BEST_ROOT}. Changed arguments of \dd{gl2psBeginPage} and
\dd{gl2psText}. Corrected some memory allocation stuff. First version of
this user's guide.
\item[0.21] (Mar 16, 2000) Initialization fixes.
\item[0.3] (Jul 29, 2000) Code cleaning. Added \dd{GL2PS_LINE_STIPPLE}.
\item[0.31] (Aug 14, 2000) Better handling of erroneous primitives.
\item[0.32] (May 23, 2001) Fixed memory leaks.
\item[0.4] (Jun 12, 2001) Added \dd{gl2psPointSize} and
\dd{gl2psLineWidth}. Some code cleaning to allow easier generation of vector
file formats other than postscript.
\item[0.41] (Aug 6, 2001) Fixed string allocation (1 char too
short). Set smaller default line width.
\item[0.42] (Oct 8, 2001) Optimization of output file size. PostScript
header cleaning. Better line width computation.
\item[0.5] (Nov 19, 2001) New \dd{format} and \dd{filename} arguments for
\dd{gl2psBeginPage}. Better PostScript handling of smooth shaded
primitives. Fix handling of zero-length strings. New options for \LaTeX\
output. Changed (again) the line width computation.
\item[0.51] (Jan 22, 2002) Fixed erroneous drawing of text primitives lying
outside the viewport.
\item[0.52] (Feb 14, 2002) New \dd{GL2PS_LANDSCAPE} option.
\item[0.53] (Mar 11, 2002) New \dd{GL2PSDLL} compilation flag to allow the
generation of a Windows dll.
\item[0.6] (Jun 4, 2002) Fixed some incoherences in string allocation; fixed
sorting of text objects; removed (non functional) occlusion culling code;
fixed handling of color and line width attributes when gl2ps was called
multiple times inside the same program.
\item[0.61] (Jun 21, 2002) Fixed the fix for the sorting of text objects;
introduced tolerance for floating point comparisons.
\item[0.62] (Sep 6, 2002) New \dd{GL2PS_EPS} option to produce Encapsulated
PostScript files; optimized drawing of shaded primitives; new
\dd{GL2PS_NO_PS3_SHADING} option and \dd{gl2psNumShadeColors} function to
control the use of the PostScript level 3 \dd{shfill} operator (usually not
well handled when converting to PDF).
\item[0.63] (Nov 12, 2002) Changed \dd{GLvoid} to \dd{void} to accomodate
some SUN compilers; made subdivision parameters modifiable a posteriori in
the output file; revised documentation.
\item[0.7] (Dec 11, 2002) Occlusion culling (\dd{GL2PS_OCCLUSION_CULL}) is
(finally!) working thanks to the great work of Shahzad Muzaffar; enhanced
\dd{GL2PS_BEST_ROOT}.
\item[0.71] (Dec 13, 2002) Removed C++ style comments inadvertently left in
the code; added example program \dd{gl2psTest.c} to the distribution.
\item[0.72] (Jan 21, 2002) Fixed crash in occlusion culling code; enhanced
documentation.
\end{description}

\end{document}

